log-level: info
mode: rule
ipv6: true

allow-lan: true
mixed-port: 7890
bind-address: '*'

profile:
  store-selected: false
  store-fake-ip: true

subscribe-url: &suburl <suburl> # https://degyax.com/user/index.html#/register?code=apc0YX7Y, a great network service provider recommended.

proxy-providers:
  DegYax: &proxyprovider
    url: *suburl
    interval: &updateinterval 66666
    health-check: &healthcheck
      url: &pingurl http://1.1.1.1/generate_204
# Apple:            http://captive.apple.com
# Google:           http://www.gstatic.com/generate_204
# Cloudflare:       http://cp.cloudflare.com/generate_204
# V2EX:             http://www.v2ex.com/generate_204
      interval: &pinginterval 66
      tolerance: &pingtolerance 6
      lazy: true

proxy-groups:
- &selectgroup
  name: $tash
  icon: https://raw.githubusercontent.com/shindgewongxj/WHATSINStash/main/icon/network.png
  type: select
  <<: *healthcheck
  proxies:
    - Select
    - Auto
    - Load Balance
    - Fallback
- <<: *selectgroup
  name: Select
  icon: https://raw.githubusercontent.com/shindgewongxj/WHATSINStash/main/icon/%24tash.png
  proxies:
  use-url:
    - *suburl
- name: Auto
  icon: https://raw.githubusercontent.com/shindgewongxj/WHATSINStash/main/icon/productivity.png
  type: url-test
  <<: *healthcheck
  use-url:
    - *suburl
- name: Fallback
  icon: https://raw.githubusercontent.com/shindgewongxj/WHATSINStash/main/icon/medical.png
  type: fallback
  <<: *healthcheck
  use-url:
    - *suburl
- name: Load Balance
  icon: https://raw.githubusercontent.com/shindgewongxj/WHATSINStash/main/icon/news.png
  type: load-balance
  strategy: consistent-hashing  # round-robin
  <<: *healthcheck
  use-url:
    - *suburl
- <<: *selectgroup
  name: Apple
  icon: https://raw.githubusercontent.com/shindgewongxj/WHATSINStash/main/icon/apple.png
- <<: *selectgroup
  name: Game
  icon: https://raw.githubusercontent.com/shindgewongxj/WHATSINStash/main/icon/games.png
- <<: *selectgroup
  name: Media
  icon: https://raw.githubusercontent.com/shindgewongxj/WHATSINStash/main/icon/entertainment.png
- <<: *selectgroup
  name: IPMocking
  icon: https://raw.githubusercontent.com/shindgewongxj/WHATSINStash/main/icon/education.png  

rule-providers:
  IPMocking: &ruleprovider
    behavior: domain-text
    url: https://raw.githubusercontent.com/shindgewongxj/WHATSINStash/main/ruleset/ipmocking.txt
    interval: *updateinterval
  Apple:
    <<: *ruleprovider
    url: https://raw.githubusercontent.com/shindgewongxj/WHATSINStash/main/ruleset/apple.txt
  Game:
    <<: *ruleprovider
    url: https://raw.githubusercontent.com/shindgewongxj/WHATSINStash/main/ruleset/game.txt
  Media:
    <<: *ruleprovider
    url: https://raw.githubusercontent.com/shindgewongxj/WHATSINStash/main/ruleset/media.txt
  Advertisments:
    <<: *ruleprovider
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Advertising/advertisements.txt
  ASN China Mainland:
    <<: *ruleprovider
    behavior: classical
    url: https://raw.githubusercontent.com/shindgewongxj/WHATSINStash/main/ruleset/asncn.yaml
 
 
rules:
- RULE-SET,Advertisments,REJECT
- RULE-SET,IPMocking,IPMocking
- RULE-SET,Apple,Apple
- RULE-SET,Game,Game
- RULE-SET,Media,Media
- RULE-SET,ASN China Mainland,DIRECT,no-resolve
- MATCH,$tash
